@Library('sfci-pipeline-sharedlib@master') _
import net.sfdc.dci.BuildUtils

env.RELEASE_BRANCHES = ['master']
def envDef = [ : ]

executePipeline(envDef) {
    stage('Init') {
        checkout scm
        gradleInit()
    }

    stage('Build') {
        try {
            sh './gradlew check'
        } finally {
            junit allowEmptyResults: false, testResults: "**/build/test-results/test/*.xml"
        }
    }
    if (BuildUtils.isReleaseBuild(env)) {
        stage('Release') {
            sh './gradlew publish'
        }
    }
}
