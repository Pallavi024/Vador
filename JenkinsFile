@Library('sfci-pipeline-sharedlib@master') _
import net.sfdc.dci.BuildUtils

def complianceFlags = [
  enable: true,
  validateSourceControlStatus: false,
  validateScheduledBuild: false,
  validateCommitsInPR: true
]

env.RELEASE_BRANCHES = ['master']
env.GUS_TEAM_NAME = 'Rev Centaurus'
env.CI=true

def envDef = [
  compliance: complianceFlags, 
  buildImage : 'ops0-artifactrepo1-0-prd.data.sfdc.net/dci/centos7-sfci-jdk11-maven:112ada4' 
]

executePipeline(envDef) {
  stage('Init') {
    checkout scm
    gradleInit()
  }

  stage('Build') {
    sh './gradlew check'
  }
  
  if (BuildUtils.isReleaseBuild(env)) {
    stage('Release') {
        sh './gradlew vader:publish'
        sh './gradlew specs:publish'
        sh './gradlew matchers:publish'
    }
  }
  
  stage('Check') {
    sh './gradlew check'
  }
  
  stage('Sonarqube') {
    sonarqube()
  }
}
