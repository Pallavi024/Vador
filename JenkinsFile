@Library('sfci-pipeline-sharedlib@master') _
import net.sfdc.dci.BuildUtils

env.RELEASE_BRANCHES = ['master']

def envDef = [ buildImage : 'ops0-artifactrepo1-0-prd.data.sfdc.net/dci/centos7-sfci-jdk11-maven:112ada4' ]

executePipeline(envDef) {
    stage('Init') {
        checkout scm
        gradleInit()
    }

    stage('Build') {
        try {
            sh './gradlew check'
        } finally {
            junit allowEmptyResults: true, testResults: "build/test-results/test/*.xml"
        }
    }
    if (BuildUtils.isReleaseBuild(env)) {
        stage('Release') {
            sh './gradlew publish'
        }
    }
}
