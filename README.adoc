= ü¶æ Vader ü¶æ
Gopal S Akshintala <gopala.akshintala@salesforce.com>
:Revision: 1.0
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
:hide-uri-scheme:
:toc:
:toc-placement!:
:vader-version: 2.6.2
:docsdir: docs
:imagesdir: {docsdir}/images

image:vader.png[role=center]

[quote,Lord Vader]
____
A piece-of-code is a costly solution to solve a simple problem
____

'''
== Mission Statement

[.lead]
*Abstract away the Validation Orchestration complexity with a Reusable Design, that sets a dev-friendly framework to Write & Wire validations that are easy to Test, Extend and Share*

'''

[#shields]
image:https://ccspaymentsci.dop.sfdc.net/buildStatus/icon?job=validation%2FVader%2Fmaster[Build Status,link=https://ccspaymentsci.dop.sfdc.net/job/validation/job/Vader/job/master/]
image:https://sonarqube.soma.salesforce.com/api/project_badges/measure?project=ccspayments.vader&metric=alert_status[Quality Gate Status,link=https://sonarqube.soma.salesforce.com/dashboard?id=ccspayments.vader]
image:https://sonarqube.soma.salesforce.com/api/project_badges/measure?project=ccspayments.vader&metric=sqale_rating[Maintainability Rating,link=https://sonarqube.soma.salesforce.com/dashboard?id=ccspayments.vader]
image:https://sonarqube.soma.salesforce.com/api/project_badges/measure?project=ccspayments.vader&metric=security_rating[Security Rating,link=https://sonarqube.soma.salesforce.com/dashboard?id=ccspayments.vader]
image:https://sonarqube.soma.salesforce.com/api/project_badges/measure?project=ccspayments.vader&metric=coverage[Coverage,link=https://sonarqube.soma.salesforce.com/dashboard?id=ccspayments.vader]
image:https://img.shields.io/badge/Rev-Delphinus.svg?logo=slack[Slack,link=https://salesforce-internal.slack.com/archives/C0228BHJCQP]

== Artifact Coordinates

[source,xml,subs=attributes+]
----
<dependency>
  <groupId>com.salesforce.ccspayments</groupId>
  <artifactId>vader</artifactId>
  <version>{vader-version}</version>
</dependency>
----

toc::[]

== Why Vader?

[.lead]
On core, there is no de-facto standard to write bean validations.

link:{docsdir}/requirements.adoc[Requirements that lead to the birth of Vader]

Validations are predominantly done with `if-else-try-catch` pyramids, similar to https://github.com/overfullstack/railway-oriented-validation/blob/master/src/main/java/app/imperative/ImperativeValidation.java[this].
A domain may have many validations across its batch & non-batch services.
Having validations as loose functions and using exceptions to halt the validation flow for the above requirements, can create a mess of function calls and execution flow.

image:function-call-mess.png[function-call-mess]

This approach can spike the https://www.ibm.com/developerworks/java/library/j-cq03316/[*Cyclomatic Complexity*]
and https://www.sonarsource.com/{docsdir}/CognitiveComplexity.pdf[*Cognitive Complexity*] metrics and renders a code-base which is difficult to test, extend and maintain.

=== Demo pls!

Watch this Tech-talk as a prerequisite to understand the problem Vader solves and its design philosophy.
It explains why `if-else-try-catch` is easy to start but difficult to manage and how Vader takes all that complexity away:

ifdef::env-github[]

.‚ñ∂Ô∏è (*Click on the talk-poster*)
image:fcwfp-poster.jpeg[link=https://www.youtube.com/watch?v=Dvr6gx4XaD8&list=PLrJbJ9wDl9EC0bG6y9fyDylcfmB_lT_Or&index=2]

endif::[]

ifndef::env-github[]
video::Dvr6gx4XaD8[youtube]
endif::[]

And the corresponding https://overfullstack.ga/posts/fight-complexity-with-fp/[Blog Post]

=== More videos

https://drive.google.com/file/d/1H_LhlYAqQKK4UjYrQ8GG9Bo3NpW2dsZL/view?usp=sharing[Presentation done for Rev Pegasus team for Cancellation API]

The below recordings are initial presentations for Vader within the team.

CAUTION: Vader's Design has evolved after these recordings, but Vader's philosophy remains the same.
Follow the rest of this doc to know more

https://drive.google.com/open?id=1AciJ3xU5HFgeTwJxL0RME0mQVO08BMQ9[Brown Bag Session]

https://drive.google.com/open?id=1Syi3smlcyFAL0ZoDuq5dWR1IALZNmNUm[An Internal Presentation] (This is partially recorded)

== TL;DR Show me the code

=== https://codesearch.data.sfdc.net/source/xref/app_main_core/app/main/core/billing-services/java/src/core/billing/service/billingschedule/config/BillingScheduleConfig.java#261[billing-services]

== What's Vader?

[.lead]
Vader is an independent *Bean validation framework*, not tied to any consumer implementation details.

Its implementation is generic and can cater to anyone looking for a declarative way to validate their Beans/POJOs.

The framework asks your validation strategy to be broken into *_3 decoupled_* parts:

* Write your Validators _(What-to-do)_ - The lambdas/functions used for validations should abide to one of the link:{docdir}/validator-types.adoc[Validator types] provided by Vader.
* Configuration _(How-to-do)_ - Stitch your validations together into a Chain.
* Execution _(How-to-do)_ - Call the Vader's API as per the execution strategy (Fail-Fast or Error-Accumulation)

Vader follows *Functional Programming* philosophy to segregate _What-to-do_ from _How-to-do_.

Let's start bottoms-up ü•Ç! We're zealous about keeping the user experience simple and the patterns uniform. So, all you need is a simple API call:

image:api.png[API]

== üëì A glance at the API

=== Vader (For Non-Batch)

[cols="1,1"]
|===
|Strategy |Result type

|===

[cols="1h,1"]
|===
|validateAndFailFast
|`Optional<FailureT>`

|validateAndAccumulateErrors
|`List<FailureT>`
|===

=== VaderBatch

[cols="1,1"]
|===
|Strategy |Result type

|===

[cols="1h,1"]
|===
|validateAndFailFastForEach
|`List<Either<FailureT, ValidatableT>>`

|validateAndFailFastForEach (With Pair for Failure)
|`List<Either<Tuple2<PairT, FailureT>, ValidatableT>>`

|validateAndFailFastForAny
|`Optional<FailureT>`

|validateAndFailFastForAny (With Pair for Failure)
|`Optional<Tuple2<PairT, FailureT>>`
|===

== link:{docsdir}/validator-types.adoc[How to write Validators?]

== link:{docsdir}/validation-configuration[Config For Validation]

== üí£ What if there is an Exception during execution üí•?

All these API methods accept an optional parameter called `throwableMapper: (Throwable) -> FailureT`, which needs to be implemented and supplied by the consumer.
If any of consumer's validations throws a checked or unchecked exception, it shall be mapped into a `FailureT` using this function.

TIP: You can place a logger or a debug point (during development) in this method you supply, to capture and analyze the exception info like stacktrace, cause etc.
We have plans to add Logger support in the future too.

== Highlights

=== üç≠ link:{docsdir}/config-dsl/dsl-driven-validation.adoc[DSL Driven Validation]

=== ü§© link:{docsdir}/specs.adoc[Specs]

== How can I trust Vader?

[.lead]
Well, coz that‚Äôs the *bread-&-jam* of what we promise!

* It‚Äôs our responsibility to address all the edge cases and automate them thoroughly, for various types of POJOs.
* We take code-quality & security seriously!
** This code base has integration with https://sonarqube.soma.salesforce.com/dashboard?id=ccspayments.vader[*SonarQube*].
** We openly display our <<shields, Code-Quality Shields>> at the top.
* This is currently being consumed in *Production*
** By 3 Teams:
*** Rev-Hydra
*** Rev-Delphinus
*** Rev-Centaurus
** In 3 different domains
*** Payments
*** Tax
*** Billing
* This idea was presented as a Tech-talk at many https://overfullstack.ga/posts/fight-complexity-with-fp/#My-Talk-on-this[International Conferences & Meetups]

That said, just like us, Vader matures day-by-day, and if any of your special use-cases don‚Äôt work, we shall love to fix them ASAP (TBD - Will publish SLA for P0, P1 etc).

NOTE: üëãüèº If you are facing any trouble or have any feature requests, please log a git.soma issue üëãüèº

image:vader.gif[]

== link:CONTRIBUTING.adoc[Wanna Collab & Contribute?]
